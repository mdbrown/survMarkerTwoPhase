{"name":"survMarkerTwoPhase","tagline":"Evaluate the prognostic accuracy of a marker under two phase designs.","body":"\r\nThis R package computes non-parametric and semi-parametric estimates of accuracy measures for risk prediction markers from survival data under two phase designs. For now, estimates can be obtained for the the case-cohort study design. Calculations for the nested case-control design will be implemented soon. \r\n\r\nOnce sample weights are obtained, the function `survMTP.estimate` estimates the **AUC**, **TPR(c)**, **FPR(c)**, **PPV(c)**, and **NPV(c)** for for a specific timepoint and marker cutoff value c.\r\n\r\nFor more information, see references below. \r\n\r\n\r\n### Download and install the package\r\n\r\n\r\n\r\n```r\r\n# download the package from github\r\nif (!require(\"devtools\")) install.packages(\"devtools\")\r\ndevtools::install_github(\"survMarkerTwoPhase\", \"mdbrown\")\r\n```\r\n\r\n\r\n\r\n```r\r\nlibrary(survMarkerTwoPhase)\r\n```\r\n\r\n```\r\n## Loading required package: survival\r\n```\r\n\r\n```\r\n## Loading required package: splines\r\n```\r\n\r\n```r\r\n\r\n# simulated data for illustration\r\ndata(SimData)\r\nhead(SimData)\r\n```\r\n\r\n```\r\n##   survTime status        Y\r\n## 1   0.1197      1  1.49310\r\n## 2   1.0231      0 -0.73260\r\n## 3   0.8282      0 -0.50211\r\n## 4   2.0875      1  0.65758\r\n## 5   4.6827      1  1.57806\r\n## 6   0.3001      1  0.02419\r\n```\r\n\r\n\r\n\r\n\r\n### Case-Cohort Design\r\n\r\nEstimation using a case-cohort subcohort design is permitted. Sample weights must first be calculated.\r\n\r\n####Type I: \r\n \r\nSample **n=150** from entire cohort, and include all participants with observed failures. \r\n\r\n\r\n```r\r\n# generate a sub-cohort from SimData\r\nset.seed(12321)\r\n# create a sample index. 1 if sampled, 0 if not\r\nN <- nrow(SimData)\r\nsampleInd <- rep(0, N)\r\n\r\n# sample all with observed failure time. (200 individuals)\r\nsampleInd[SimData$status == 1] <- 1\r\n\r\n# sample 150 more observations from the entire data set without\r\n# replacement\r\nsampleInd[sample(1:N, 150)] <- 1\r\n\r\ntable(sampleInd)  #total number of subcohort is 293 \r\n```\r\n\r\n```\r\n## sampleInd\r\n##   0   1 \r\n## 207 293\r\n```\r\n\r\n\r\nNow we calculate the sample weights *w = 1/Pr(Sampled from cohort)* for each observation included in the sub-cohort. \r\n\r\n```r\r\n# first calculate the Pr(Sampled from cohort) for each observation\r\nsampleProb <- numeric(500)\r\n\r\n# all non-censored observations were sampled, so their sample probability\r\n# is 1\r\nsampleProb[SimData$status == 1] <- 1\r\n# all other individuals had a 150/N chance to be sampled\r\nsampleProb[SimData$status == 0] <- 150/N\r\n\r\n# the sample weights are 1/(probability of being sampled)\r\nSimData$weights <- 1/sampleProb\r\n\r\nsubCohortData <- SimData[sampleInd == 1, ]\r\n```\r\n\r\nHere we estimate all measures available using non-parametric estimation methods. For non-parametric estimation, we need to provide the subcohort data consisting of status, survival time, marker, and weight, as well as survival time and status for the full cohort.   \r\n\r\n\r\n```r\r\n# estimate accuracy measures using non-parametric estimates by setting\r\n# ESTmethod = 'NP' we have to supply subcohort data and full cohort data\r\nsurvMTP.estimate(time = \"survTime\", event = \"status\", marker = \"Y\", weights = \"weights\", \r\n    subcohort.data = subCohortData, cohort.data = SimData, cohort.size = N, \r\n    estimation.method = \"NP\", study.design = \"Case-Cohort\", predict.time = 2, \r\n    cutpoint = 0)\r\n```\r\n\r\n```\r\n## \r\n##  Non-parametric estimates under Case-Cohort study design.\r\n## \r\n##         estimate\r\n## AUC        0.749\r\n## TPR(c)     0.699\r\n## FPR(c)     0.394\r\n## PPV(c)     0.331\r\n## NPV(c)     0.878\r\n## \r\n##  marker cutpoint: c = 0\r\n```\r\n\r\n\r\nNow estimate all measures  using semi-parametric estimation methods. These methods assume a Cox proportional hazards model. We only have to provide subcohort data in this case. \r\n\r\n\r\n```r\r\n# estimate accuracy measures using semi-parametric estimates, we only need\r\n# the sub-cohort data here\r\nsurvMTP.estimate(time = \"survTime\", event = \"status\", marker = \"Y\", weights = \"weights\", \r\n    subcohort.data = subCohortData, cohort.size = N, estimation.method = \"SP\", \r\n    study.design = \"Case-Cohort\", predict.time = 2, cutpoint = 0)\r\n```\r\n\r\n```\r\n## \r\n##  Semi-parametric estimates under Case-Cohort study design.\r\n## \r\n##         estimate\r\n## coef       1.088\r\n## AUC        0.788\r\n## TPR(c)     0.770\r\n## FPR(c)     0.347\r\n## PPV(c)     0.386\r\n## NPV(c)     0.909\r\n## \r\n##  marker cutpoint: c = 0\r\n```\r\n\r\n\r\nOnly estimate the **AUC** and **TPR(0)**. \r\n\r\n\r\n```r\r\ntmp <- survMTP.estimate(time = \"survTime\", event = \"status\", marker = \"Y\", weights = \"weights\", \r\n    subcohort.data = subCohortData, cohort.size = N, study.design = \"Case-Cohort\", \r\n    estimation.method = \"SP\", predict.time = 2, measures = c(\"AUC\", \"TPR\"), \r\n    cutpoint = 0)\r\ntmp\r\n```\r\n\r\n```\r\n## \r\n##  Semi-parametric estimates under Case-Cohort study design.\r\n## \r\n##         estimate\r\n## coef       1.088\r\n## AUC        0.788\r\n## TPR(c)     0.770\r\n## \r\n##  marker cutpoint: c = 0\r\n```\r\n\r\n\r\n\r\n```r\r\n# access the estimates\r\ntmp$estimates\r\n```\r\n\r\n```\r\n##    coef    AUC    TPR\r\n## 1 1.088 0.7876 0.7705\r\n```\r\n\r\n\r\n####Type II: \r\n \r\nIn the second sampling design, we sample **n=100** from the strata of participants with observed failures and **n=100** from censored individuals. We need to account for this when we calculate the sampling weights. \r\n\r\n\r\n```r\r\n# create a new sample index. 1 if sampled, 0 if not\r\nsampleInd <- rep(0, N)\r\n\r\n# sample 100 individuals with observed failure time.\r\nCaseInd <- c(1:N)[SimData$status == 1]\r\nsampleInd[sample(CaseInd, 100)] <- 1\r\n\r\n# sample 100 individuals with censored failure time.\r\nControlInd <- c(1:N)[SimData$status == 0]\r\nsampleInd[sample(ControlInd, 100)] <- 1\r\n\r\ntable(sampleInd)  #total number of subcohort is 200 \r\n```\r\n\r\n```\r\n## sampleInd\r\n##   0   1 \r\n## 300 200\r\n```\r\n\r\n\r\nCalculate the sample weights.\r\n\r\n\r\n```r\r\n# first calculate the Pr(Sampled from cohort) for each observation\r\nsampleProb <- numeric(500)\r\n\r\n# all non-censored observations were sampled\r\nsampleProb[SimData$status == 1] <- 100/length(CaseInd)\r\nsampleProb[SimData$status == 0] <- 100/length(ControlInd)\r\n\r\nSimData$weights2 <- 1/sampleProb\r\n\r\nsubCohortData2 <- SimData[sampleInd == 1, ]\r\n```\r\n\r\n\r\nEstimate all measures available, first using non-parametric estimation and then using semi-parametric estimates. \r\n\r\n\r\n```r\r\n# Non-parametric estimates\r\nsurvMTP.estimate(time = \"survTime\", event = \"status\", marker = \"Y\", weights = \"weights2\", \r\n    subcohort.data = subCohortData2, cohort.data = SimData, cohort.size = N, \r\n    estimation.method = \"NP\", study.design = \"Case-Cohort\", predict.time = 2, \r\n    cutpoint = 0)\r\n```\r\n\r\n```\r\n## \r\n##  Non-parametric estimates under Case-Cohort study design.\r\n## \r\n##         estimate\r\n## AUC        0.694\r\n## TPR(c)     0.590\r\n## FPR(c)     0.377\r\n## PPV(c)     0.340\r\n## NPV(c)     0.822\r\n## \r\n##  marker cutpoint: c = 0\r\n```\r\n\r\n```r\r\n\r\n# Semi-parametric estimates\r\nsurvMTP.estimate(time = \"survTime\", event = \"status\", marker = \"Y\", weights = \"weights2\", \r\n    subcohort.data = subCohortData2, cohort.size = N, estimation.method = \"SP\", \r\n    study.design = \"Case-Cohort\", predict.time = 2, cutpoint = 0)\r\n```\r\n\r\n```\r\n## \r\n##  Semi-parametric estimates under Case-Cohort study design.\r\n## \r\n##         estimate\r\n## coef       0.908\r\n## AUC        0.751\r\n## TPR(c)     0.683\r\n## FPR(c)     0.311\r\n## PPV(c)     0.423\r\n## NPV(c)     0.867\r\n## \r\n##  marker cutpoint: c = 0\r\n```\r\n\r\nFor more information see `?survMTP.estimate`. \r\n\r\n\r\n### References\r\nLiu D, Cai T, Zheng Y. Evaluating the predictive value of biomarkers with stratified case-cohort design. *Biometrics* 2012, 4: 1219-1227.\r\n\r\nPepe MS, Zheng Y, Jin Y. Evaluating the ROC performance of markers for future events. *Lifetime Data Analysis.* 2008, 14: 86-113.\r\n\r\nZheng Y, Cai T, Pepe MS, Levy, W. Time-dependent predictive values of prognostic biomarkers with failure time outcome. *JASA* 2008, 103: 362-368.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}