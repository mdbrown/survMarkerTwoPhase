{"name":"survMarkerTwoPhase","tagline":"Evaluate the prognostic accuracy of a marker under two phase designs.","body":"This R package computes non-parametric and semi-parametric estimates of accuracy measures for risk prediction markers from survival data under two phase study designs, namely the case-cohort (cch) and the nested case-control (ncc) study designs. Semi-parametric estimates assume a cox proportional hazards model, while non-parametric calculations use kernel based smoothing to obtain estimates.  \r\n\r\nThe accuracy measures that can be estimated include the **AUC**, **TPR(c)**, **FPR(c)**, **PPV(c)**, and **NPV(c)** for for a specific timepoint and fixed marker cutoff value c. Standard errors, along with normal approximated confidence intervals can be calculated under the ncc design, but are unavailable for the cch design as of now. Standard errors are calculated using perturbation methods. \r\n\r\nBelow is a brief tutorial to get you started. For more information regarding estimation procedures see the references below. \r\n\r\n\r\n##Tutorial\r\n\r\n### Download and install the package\r\n\r\n\r\n\r\n```r\r\n# download the package from github\r\nif (!require(\"devtools\")) install.packages(\"devtools\")\r\ndevtools::install_github(\"survMarkerTwoPhase\", \"mdbrown\")\r\n```\r\n\r\n\r\n\r\n```r\r\nlibrary(survMarkerTwoPhase)\r\n\r\n# simulated data for illustration\r\ndata(SimData)\r\nhead(SimData)\r\n```\r\n\r\n```\r\n##   survTime status        Y\r\n## 1   0.1197      1  1.49310\r\n## 2   1.0231      0 -0.73260\r\n## 3   0.8282      0 -0.50211\r\n## 4   2.0875      1  0.65758\r\n## 5   4.6827      1  1.57806\r\n## 6   0.3001      1  0.02419\r\n```\r\n\r\n\r\n\r\n\r\n### Case-cohort design\r\n\r\nFor the case-cohort design we sample **n=150** from entire cohort, and include all participants with observed failures. \r\n\r\n\r\n```r\r\n# generate a sub-cohort from SimData\r\nset.seed(12321)\r\n# create a sample index. 1 if sampled, 0 if not\r\nN <- nrow(SimData)\r\nsampleInd <- rep(0, N)\r\n\r\n# sample all with observed failure time. (200 individuals)\r\nsampleInd[SimData$status == 1] <- 1\r\n\r\n# sample 150 more observations from the entire data set without replacement\r\nsampleInd[sample(1:N, 150)] <- 1\r\n\r\ntable(sampleInd)  #total number of subcohort is 293 \r\n```\r\n\r\n```\r\n## sampleInd\r\n##   0   1 \r\n## 207 293\r\n```\r\n\r\nTo estimate accuracy measures for the case-cohort design, sample weights must be calculated. The sample weights *w = 1/Pr(Sampled from cohort)* for each observation included in the sub-cohort. \r\n\r\n```r\r\ncohortData_cch <- SimData\r\n\r\n# first calculate the Pr(Sampled from cohort) for each observation\r\nsampleProb <- numeric(500)\r\n\r\n# all non-censored observations were sampled, so their sample probability is\r\n# 1\r\nsampleProb[cohortData_cch$status == 1] <- 1\r\n# all other individuals had a 150/N chance to be sampled\r\nsampleProb[cohortData_cch$status == 0] <- 150/N\r\n\r\n# the sample weights are 1/(probability of being sampled)\r\ncohortData_cch$weights <- 1/sampleProb\r\n\r\n# indicator of inclusion in the subcohort\r\ncohortData_cch$subcohort = sampleInd\r\n\r\n# marker data is unavailable for those not in the subcohort\r\ncohortData_cch$Y[sampleInd == 0] = NA\r\n```\r\n\r\nHere we estimate using non-parametric estimation methods.   \r\n\r\n\r\n```r\r\n# estimate accuracy measures using non-parametric estimates by setting\r\n# estimation.method = 'NP'\r\nsurvMTP.cch(time = survTime, event = status, marker = Y, weights = weights, \r\n    subcoh = subcohort, data = cohortData_cch, estimation.method = \"NP\", predict.time = 2, \r\n    marker.cutpoint = 0)\r\n```\r\n\r\n```\r\n## \r\n##  Non-parametric estimates under Case-Cohort study design.\r\n## \r\n##         estimate\r\n## AUC        0.749\r\n## TPR(c)     0.699\r\n## FPR(c)     0.394\r\n## PPV(c)     0.331\r\n## NPV(c)     0.878\r\n## \r\n##  marker cutpoint: c = 0\r\n```\r\n\r\n\r\nNow estimate measures  using semi-parametric estimation methods. These methods assume a Cox proportional hazards model.\r\n\r\n\r\n```r\r\n# estimate accuracy measures using semi-parametric estimates\r\nsurvMTP.cch(time = survTime, event = status, marker = Y, weights = weights, \r\n    subcoh = subcohort, data = cohortData_cch, estimation.method = \"SP\", predict.time = 2, \r\n    marker.cutpoint = 0)\r\n```\r\n\r\n```\r\n## \r\n##  Semi-parametric estimates under Case-Cohort study design.\r\n## \r\n##         estimate\r\n## coef       1.088\r\n## AUC        0.788\r\n## TPR(c)     0.770\r\n## FPR(c)     0.347\r\n## PPV(c)     0.386\r\n## NPV(c)     0.909\r\n## \r\n##  marker cutpoint: c = 0\r\n```\r\n\r\n\r\n\r\nFor more information see `?survMTP.cch`. \r\n\r\n### Nested case-control\r\nFor a nested case-control sample, we need to input the full cohort data, with an indicator for inclusion in the subcohort, as well as a dataframe of risk sets, where each row is a case id followed by the corresponding id's that were matched to it. \r\n\r\nGenerate a nested case-control subcohort using the function `ccwc` from the [`Epi`](http://cran.r-project.org/web/packages/Epi/index.html) package. \r\n\r\n\r\n```r\r\nrequire(\"Epi\")\r\n\r\n# 2 matched controls for each case\r\nnmatch = 2\r\n\r\ncohortData_ncc <- SimData\r\ncohortData_ncc$id = 1:dim(cohortData_ncc)[1]\r\n\r\nsubcohort_ncc <- ccwc(exit = survTime, fail = status, data = cohortData_ncc, \r\n    controls = nmatch)  # match 2 controls for each case. \r\n\r\n# indicator for inclusion in the subcohort\r\nsampleInd = rep(0, nrow(cohortData_ncc))  #initialize all equal to zero\r\nsampleInd[subcohort_ncc$Map] = 1\r\n\r\ncohortData_ncc$subcohort = sampleInd\r\n\r\ntable(sampleInd)  #subcohort sample size of 352\r\n\r\n# marker data is unavailable for those not in the subcohort\r\ncohortData_ncc$Y[sampleInd == 0] = NA\r\n\r\n# now we need to build the risk set matrix, which will be dimension (# of\r\n# cases) x (nmatch + 1), so 200x3 here each row denotes a risk set, with the\r\n# case id followed by the matched control ids\r\nRiskSets <- matrix(nrow = sum(cohortData_ncc$status), ncol = nmatch + 1)\r\n\r\nfor (i in subcohort_ncc$Set) {\r\n    RiskSets[i, ] <- unlist(subset(subcohort_ncc, Set == i, select = Map))\r\n}\r\n```\r\n\r\n\r\nNow we are ready to calculate the measures using `survMTP.ncc`. \r\n\r\n\r\n```r\r\n# Nonparametric estimates\r\nsurvMTP.ncc(time = survTime, event = status, marker = Y, subcoh = subcohort, \r\n    id = id, data = cohortData_ncc, risk.sets = RiskSets, estimation.method = \"NP\", \r\n    predict.time = 2, marker.cutpoint = 0)\r\n```\r\n\r\n```\r\n## \r\n##  Non-parametric estimates under Nested Case-Control study design.\r\n## \r\n##         estimate     se      lower 0.95  upper 0.95\r\n## \r\n## AUC        0.742     0.027         0.690       0.795 \r\n## FPR(c)     0.379     0.032         0.316       0.443 \r\n## TPR(c)     0.684     0.044         0.598       0.770 \r\n## NPV(c)     0.875     0.020         0.837       0.914 \r\n## PPV(c)     0.335     0.033         0.270       0.401 \r\n## \r\n##  marker cutpoint: c = 0\r\n```\r\n\r\n\r\n\r\n```r\r\n# Semiparametric estimates\r\nsurvMTP.ncc(time = survTime, event = status, marker = Y, subcoh = subcohort, \r\n    id = id, data = cohortData_ncc, risk.sets = RiskSets, estimation.method = \"SP\", \r\n    predict.time = 2, marker.cutpoint = 0)\r\n```\r\n\r\n```\r\n## \r\n##  Semi-parametric estimates under Nested Case-Control study design.\r\n## \r\n##         estimate     se      lower 0.95  upper 0.95\r\n## \r\n## coef       1.017     0.082         0.857       1.177 \r\n## AUC        0.777     0.020         0.738       0.815 \r\n## FPR(c)     0.356     0.030         0.297       0.416 \r\n## TPR(c)     0.755     0.030         0.696       0.813 \r\n## NPV(c)     0.900     0.013         0.875       0.926 \r\n## PPV(c)     0.381     0.032         0.319       0.443 \r\n## \r\n##  marker cutpoint: c = 0\r\n```\r\n\r\n \r\nSee `?survMTP.ncc` for further help. \r\n\r\n### References\r\n\r\n1. Liu D, Cai T, Zheng Y. Evaluating the predictive value of biomarkers with stratified case-cohort design. *Biometrics* 2012, 4: 1219-1227.\r\n\r\n2. Pepe MS, Zheng Y, Jin Y. Evaluating the ROC performance of markers for future events. *Lifetime Data Analysis.* 2008, 14: 86-113.\r\n\r\n3. Zheng Y, Cai T, Pepe MS, Levy, W. Time-dependent predictive values of prognostic biomarkers with failure time outcome. *JASA* 2008, 103: 362-368.\r\n\r\n4. Cai T. and Zheng Y . Resampling Procedures for Making Inference under Nested Case-control Studies. *JASA* 2013 (in press). \r\n\r\n5. Cai T and Zheng Y/*, Evaluating Prognostic Accuracy of Biomarkers under nested case-control studies. *Biostatistics* 2012, 13,1, 89-100. \r\n\r\n(* equal contributor and corresponding author). \r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}